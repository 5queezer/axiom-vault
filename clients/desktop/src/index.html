<!DOCTYPE html>
<html lang="en">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>AxiomVault</title>
    <link rel="stylesheet" href="vendor/all.min.css">
    <link rel="stylesheet" href="styles.css">
</head>
<body>
<div class="titlebar-drag-region"></div>

<div id="app">
    <div class="main-container">
        <div class="sidebar">
            <div class="sidebar-section">
                <div class="sidebar-header">Vaults</div>

                <div v-if="vaults.length === 0" style="padding: 10px; color: #666; font-size: 12px; text-align: center;">
                    No Vaults
                </div>

                <div v-for="vault in vaults"
                     :key="vault.id"
                     :class="['vault-item', { active: currentVaultId === vault.id }]"
                     @click="selectVault(vault.id)">
                    <i class="fa-solid fa-cube"></i>
                    <span style="flex:1; overflow:hidden; text-overflow:ellipsis;">{{ vault.id }}</span>
                    <div :class="['vault-status-dot', { mounted: vault.is_mounted }]"
                         :title="vault.is_mounted ? 'Mounted' : 'Unlocked'"></div>
                </div>
            </div>

            <div class="sidebar-footer">
                <button class="icon-btn" @click="showModal('create')" title="Create Vault">
                    <i class="fa-solid fa-plus"></i>
                </button>
                <button class="icon-btn" @click="showModal('unlock')" title="Unlock Vault">
                    <i class="fa-solid fa-key"></i>
                </button>
            </div>
        </div>

        <div class="content">
            <div class="toolbar">
                <div class="toolbar-title">
                    <template v-if="currentVaultId">
                        <i class="fa-solid fa-box-archive" style="color:var(--mac-blue);"></i>
                        {{ currentVaultId }}
                    </template>
                    <span v-else>AxiomVault</span>
                </div>

                <div class="toolbar-actions" v-if="currentVaultId">
                    <button class="tool-btn" @click="createNewFile">
                        <i class="fa-regular fa-file"></i> New
                    </button>
                    <button class="tool-btn" @click="createNewFolder">
                        <i class="fa-solid fa-folder-plus"></i> Folder
                    </button>
                    <button class="tool-btn" @click="toggleMount">
                        <i class="fa-solid fa-hard-drive"></i> Mount
                    </button>
                    <button class="tool-btn" @click="lockVault" style="color: #ff453a;">
                        <i class="fa-solid fa-lock"></i> Lock
                    </button>
                </div>

                <div style="font-size: 11px; color: var(--mac-text-secondary);">
                    {{ fuseStatus }}
                </div>
            </div>

            <div v-if="!currentVaultId" class="empty-state">
                <i class="fa-solid fa-shield-halved"></i>
                <h3>No Vault Selected</h3>
                <p style="font-size: 13px;">Select a vault from the sidebar or create a new one.</p>
            </div>

            <div v-else style="display: flex; flex: 1; flex-direction: column;">
                <div class="path-bar">
                        <span v-for="(segment, index) in breadcrumbs" :key="index"
                              :class="['path-segment', { current: index === breadcrumbs.length - 1 }]">
                            <span v-if="index > 0" style="color:#666; margin:0 4px;">/</span>
                            {{ segment || 'Root' }}
                        </span>
                </div>

                <div class="file-list-container">
                    <div v-if="files.length === 0" class="empty-state" style="height: 200px;">
                        <p>Folder is empty</p>
                    </div>

                    <div v-if="currentPath !== '/'" class="file-row" @click="navigateUp">
                        <div class="file-icon folder"><i class="fa-solid fa-folder"></i></div>
                        <div class="file-name">..</div>
                    </div>

                    <div v-for="file in sortedFiles" :key="file.path" class="file-row" @click="handleItemClick(file)">
                        <div :class="['file-icon', file.is_directory ? 'folder' : 'file']">
                            <i :class="file.is_directory ? 'fa-solid fa-folder' : 'fa-regular fa-file'"></i>
                        </div>
                        <div class="file-name">{{ file.name }}</div>
                        <div class="file-meta">{{ file.size ? formatSize(file.size) : '--' }}</div>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <transition name="modal">
        <div v-if="activeModal" class="modal-backdrop" @click.self="closeModal">
            <transition name="sheet" appear>

                <div v-if="activeModal === 'create'" class="sheet">
                    <h3>Create New Vault</h3>
                    <p class="subtitle">Enter details for your new secure container.</p>
                    <div class="form-row">
                        <label>Vault Name</label>
                        <input type="text" class="mac-input" v-model="forms.create.name" placeholder="Documents">
                    </div>
                    <div class="form-row">
                        <label>Password</label>
                        <input type="password" class="mac-input" v-model="forms.create.password">
                    </div>
                    <div class="form-row">
                        <label>Verify</label>
                        <input type="password" class="mac-input" v-model="forms.create.confirm">
                    </div>
                    <div class="form-row">
                        <label>Provider</label>
                        <select class="mac-select" v-model="forms.create.provider">
                            <option value="memory">Local Memory</option>
                            <option value="gdrive">Google Drive</option>
                        </select>
                    </div>
                    <div class="sheet-footer">
                        <button class="mac-btn secondary" @click="closeModal">Cancel</button>
                        <button class="mac-btn primary" @click="createVault">Create</button>
                    </div>
                </div>

                <div v-else-if="activeModal === 'unlock'" class="sheet">
                    <h3>Unlock Vault</h3>
                    <p class="subtitle">Enter your credentials.</p>
                    <div class="form-row">
                        <label>Vault ID</label>
                        <input type="text" class="mac-input" v-model="forms.unlock.id" placeholder="Documents">
                    </div>
                    <div class="form-row">
                        <label>Password</label>
                        <input type="password" class="mac-input" v-model="forms.unlock.password">
                    </div>
                    <div class="sheet-footer">
                        <button class="mac-btn secondary" @click="closeModal">Cancel</button>
                        <button class="mac-btn primary" @click="unlockVault">Unlock</button>
                    </div>
                </div>

                <div v-else-if="activeModal === 'mount'" class="sheet">
                    <h3>Mount Volume</h3>
                    <p class="subtitle">Select a mount point.</p>
                    <div class="form-row">
                        <label>Mount Point</label>
                        <input type="text" class="mac-input" v-model="forms.mount.point" placeholder="/mnt/vault">
                    </div>
                    <div class="sheet-footer">
                        <button class="mac-btn secondary" @click="closeModal">Cancel</button>
                        <button class="mac-btn primary" @click="mountVault">Mount</button>
                    </div>
                </div>

            </transition>
        </div>
    </transition>

    <transition name="toast">
        <div v-if="notification.show" class="toast">
            <i :class="['fa-solid', notification.isError ? 'fa-circle-exclamation' : 'fa-circle-check']"
               :style="{ color: notification.isError ? '#ff453a' : '#0a84ff' }"></i>
            <span>{{ notification.message }}</span>
        </div>
    </transition>
</div>

<script type="module" src="app.js"></script>
</body>
</html>
